<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Providers</title>
  <meta name="description" content="As you’ll know watchOS 2 allows you to create your own complications. One thing that really stood out to me is the idea of using providers instead of setting either text or images directly. There’s..." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JanGorman" />
    <meta name="twitter:title" content="Providers" />
    <meta name="twitter:image" content="" />
    
    <meta name="twitter:description"  content="As you’ll know watchOS 2 allows you to create your own complications. One thing that really stood out to me is the idea of using providers instead of setting either text or images directly. There’s..." />
    
  
  
  <meta property="og:site_name" content="Jan Gorman" />
  <meta property="og:title" content="Providers"/>
  
  <meta property="og:description" content="As you’ll know watchOS 2 allows you to create your own complications. One thing that really stood out to me is the idea of using providers instead of setting either text or images directly. There’s..." />
  
  <meta property="og:image" content="" />
  <meta property="og:url" content="/blog/2015/08/26/providers/" >
  <meta property="og:type" content="blog" />
  <meta property="article:published_time" content="2015-08-26T11:42:40+02:00">

  <link rel="canonical" href="/blog/2015/08/26/providers/"/>
  <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>
  <link href='/stylesheets/all-456658fd402f091f6213dc405e964de6.css' media='all' rel='stylesheet' type='text/css'>
  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->


<!-- header end -->
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Providers</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/jg.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"></h4>
              on
              <time datetime="2015-08-26T11:42:40+02:00">26 Aug 2015</time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>As you’ll know watchOS 2 allows you to create your own <a href="https://developer.apple.com/library/prerelease/watchos/documentation/General/Conceptual/AppleWatch2TransitionGuide/CreatingaComplication.html#//apple_ref/doc/uid/TP40015234-CH10-SW1">complications</a>. One thing that really stood out to me is the idea of using providers instead of setting either text or images directly. There’s the abstract base class <a href="https://developer.apple.com/library/prerelease/watchos/documentation/ClockKit/Reference/CLKTextProvider_class/index.html#//apple_ref/occ/cl/CLKTextProvider">CLKTextProvider</a> and <a href="https://developer.apple.com/library/prerelease/watchos/documentation/ClockKit/Reference/CLKImageProvider_class/index.html#//apple_ref/occ/cl/CLKImageProvider">CLKImageProvider</a> that you provide (boom) to your complication. It’s the context in which the complication is rendered that decides on the actual on-screen representation of information.</p>

<p>So there’s this app I used to work on that needs to display prices a lot. And depending on the context where this prices is displayed it renders differently. Sounds similar to what the complication does. So in a grossly oversimplified example, let’s build something around providers using Swift:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">PriceTextProvider</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">basePrice</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">let</span> <span class="nv">reducedPrice</span><span class="p">:</span> <span class="kt">Double</span>
    <span class="k">let</span> <span class="nv">vat</span><span class="p">:</span> <span class="kt">Double</span>

<span class="p">}</span>
</code></pre></div></div>

<p>This is our base provider. For demo purposes we’ll use <code class="highlighter-rouge">Double</code> for the prices.</p>

<p>Next come our options on <em>what</em> we want to show using the new and great <code class="highlighter-rouge">OptionSetType</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">PriceTextRenderOptions</span><span class="p">:</span> <span class="kt">OptionSetType</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">rawValue</span> <span class="o">=</span> <span class="n">rawValue</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="k">let</span> <span class="nv">Base</span> <span class="o">=</span> <span class="kt">PriceTextRenderOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">Reduced</span> <span class="o">=</span> <span class="kt">PriceTextRenderOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">Vat</span> <span class="o">=</span> <span class="kt">PriceTextRenderOptions</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">BaseAndReduced</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Base</span><span class="p">,</span> <span class="kt">Reduced</span><span class="p">]</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">FullPrice</span> <span class="o">=</span> <span class="p">[</span><span class="kt">Base</span><span class="p">,</span> <span class="kt">Reduced</span><span class="p">,</span> <span class="kt">Vat</span><span class="p">]</span>

<span class="p">}</span>
</code></pre></div></div>

<p>And context:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">enum</span> <span class="kt">PriceTextContext</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">Normal</span><span class="p">,</span> <span class="kt">Short</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Of course we could also opt to just have a context enum that then actually decides which rendering options to use. Maybe we should, I’m undecided.</p>

<p>And now the renderer:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">PriceTextRenderer</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">priceFormatter</span><span class="p">:</span> <span class="kt">NSNumberFormatter</span>
    <span class="k">let</span> <span class="nv">vatFormatter</span><span class="p">:</span> <span class="kt">NSNumberFormatter</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">priceFormatter</span><span class="p">:</span> <span class="kt">NSNumberFormatter</span><span class="p">,</span> <span class="nv">vatFormatter</span><span class="p">:</span> <span class="kt">NSNumberFormatter</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">priceFormatter</span> <span class="o">=</span> <span class="n">priceFormatter</span>
        <span class="k">self</span><span class="o">.</span><span class="n">vatFormatter</span> <span class="o">=</span> <span class="n">vatFormatter</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">render</span><span class="p">(</span><span class="nv">provider</span><span class="p">:</span> <span class="kt">PriceTextProvider</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">PriceTextContext</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="kt">PriceTextRenderOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSAttributedString</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">attributedPrice</span> <span class="o">=</span> <span class="kt">NSMutableAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">""</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">glue</span> <span class="o">=</span> <span class="n">context</span> <span class="o">==</span> <span class="o">.</span><span class="kt">Normal</span> <span class="p">?</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span> <span class="p">:</span> <span class="s">" "</span>
        
        <span class="k">if</span> <span class="k">let</span> <span class="nv">basePrice</span> <span class="o">=</span> <span class="n">priceFormatter</span><span class="o">.</span><span class="nf">stringFromNumber</span><span class="p">(</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">double</span><span class="p">:</span> <span class="n">provider</span><span class="o">.</span><span class="n">basePrice</span><span class="p">))</span> <span class="k">where</span> <span class="n">options</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="o">.</span><span class="kt">Base</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">a</span> <span class="o">=</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">basePrice</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSForegroundColorAttributeName</span><span class="p">:</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">greenColor</span><span class="p">()])</span>
            <span class="n">attributedPrice</span><span class="o">.</span><span class="nf">appendAttributedString</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">reducedPrice</span> <span class="o">=</span> <span class="n">priceFormatter</span><span class="o">.</span><span class="nf">stringFromNumber</span><span class="p">(</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">double</span><span class="p">:</span> <span class="n">provider</span><span class="o">.</span><span class="n">reducedPrice</span><span class="p">))</span> <span class="k">where</span> <span class="n">options</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="o">.</span><span class="kt">Reduced</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">a</span> <span class="o">=</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">glue</span><span class="se">)\(</span><span class="n">reducedPrice</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">attributes</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSForegroundColorAttributeName</span><span class="p">:</span> <span class="kt">UIColor</span><span class="o">.</span><span class="nf">redColor</span><span class="p">()])</span>
            <span class="n">attributedPrice</span><span class="o">.</span><span class="nf">appendAttributedString</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">vat</span> <span class="o">=</span> <span class="n">vatFormatter</span><span class="o">.</span><span class="nf">stringFromNumber</span><span class="p">(</span><span class="kt">NSNumber</span><span class="p">(</span><span class="nv">double</span><span class="p">:</span> <span class="n">provider</span><span class="o">.</span><span class="n">vat</span><span class="p">))</span> <span class="k">where</span> <span class="n">options</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="o">.</span><span class="kt">Vat</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">a</span> <span class="o">=</span> <span class="kt">NSAttributedString</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">glue</span><span class="se">)\(</span><span class="n">vat</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="n">attributedPrice</span><span class="o">.</span><span class="nf">appendAttributedString</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">attributedPrice</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>There’s a few things going on here. So let’s brake it down:</p>

<p>First we’re supplying the renderer with our <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSNumberFormatter_Class/">NSNumberFormatters</a>. Still I see people displaying prices without using formatters. Stop it, you’re doing it wrong. Even if your designers or you insist on really specific formats (though I’d always argue to rather go with the locale defaults), you can fine tune every last bit of the formatter to your liking.</p>

<p>Next up is the render method. You’ll probably want to really fine tune this part. Ideas that come to mind are a <code class="highlighter-rouge">.Short</code> format that removes decimal places if appropriate, drops certain parts of the price and things like glue words that can be prepended or formatted in a specific way. E.g. <code class="highlighter-rouge">VAT: %s</code>. Or maybe work out the reduction in price and highlight that. People love a bargain.</p>

<p>So finally calling the whole thing:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">locale</span> <span class="o">=</span> <span class="kt">NSLocale</span><span class="p">(</span><span class="nv">localeIdentifier</span><span class="p">:</span> <span class="s">"de_DE"</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">priceFormatter</span> <span class="o">=</span> <span class="kt">NSNumberFormatter</span><span class="p">()</span>
<span class="n">priceFormatter</span><span class="o">.</span><span class="n">numberStyle</span> <span class="o">=</span> <span class="o">.</span><span class="kt">CurrencyStyle</span>
<span class="n">priceFormatter</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span>

<span class="k">let</span> <span class="nv">vatFormatter</span> <span class="o">=</span> <span class="kt">NSNumberFormatter</span><span class="p">()</span>
<span class="n">vatFormatter</span><span class="o">.</span><span class="n">numberStyle</span> <span class="o">=</span> <span class="o">.</span><span class="kt">PercentStyle</span>
<span class="n">vatFormatter</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">locale</span>

<span class="k">let</span> <span class="nv">renderer</span> <span class="o">=</span> <span class="kt">PriceTextRenderer</span><span class="p">(</span><span class="nv">priceFormatter</span><span class="p">:</span> <span class="n">priceFormatter</span><span class="p">,</span> <span class="nv">vatFormatter</span><span class="p">:</span> <span class="n">vatFormatter</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">provider</span> <span class="o">=</span> <span class="kt">PriceTextProvider</span><span class="p">(</span><span class="nv">basePrice</span><span class="p">:</span> <span class="mf">20.00</span><span class="p">,</span> <span class="nv">reducedPrice</span><span class="p">:</span> <span class="mf">15.00</span><span class="p">,</span> <span class="nv">vat</span><span class="p">:</span> <span class="mf">0.19</span><span class="p">)</span>
<span class="n">renderer</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="o">.</span><span class="kt">Normal</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="kt">Base</span><span class="p">,</span> <span class="o">.</span><span class="kt">Reduced</span><span class="p">,</span> <span class="o">.</span><span class="kt">Vat</span><span class="p">])</span>
<span class="n">renderer</span><span class="o">.</span><span class="nf">render</span><span class="p">(</span><span class="n">provider</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="o">.</span><span class="kt">Short</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="kt">Base</span><span class="p">,</span> <span class="o">.</span><span class="kt">Reduced</span><span class="p">])</span>
</code></pre></div></div>

<p>Get the whole thing as a playground over at this <a href="https://gist.github.com/JanGorman/2a28acc110c8c9f38993">github gist</a>.</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Providers&amp;url=/blog/2015/08/26/providers"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/jg.jpg)">Blog Logo</div>
              <h4>Jan Gorman</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-08-26 11:42">26 Aug 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Jan Gorman</a> &copy; 2017<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background-image.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Jan Gorman</h1>
        <h2 class="blog-description">Compiling Swift Source Files</h2>
        <a href=/ class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>
  </body>
</html>
