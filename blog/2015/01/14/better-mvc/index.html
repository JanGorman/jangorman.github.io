<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>Better MVC</title>
  <meta name="description" content="I had been meaning to write this for a while now. And even if the examples are all in Swift (because shiny) the same can be applied to Objective-C code as well without any problem." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JanGorman" />
    <meta name="twitter:title" content="Better MVC" />
    <meta name="twitter:image" content="" />
    
    <meta name="twitter:description"  content="I had been meaning to write this for a while now. And even if the examples are all in Swift (because shiny) the same can be applied to Objective-C code as well without any problem." />
    
  
  
  <meta property="og:site_name" content="Jan Gorman" />
  <meta property="og:title" content="Better MVC"/>
  
  <meta property="og:description" content="I had been meaning to write this for a while now. And even if the examples are all in Swift (because shiny) the same can be applied to Objective-C code as well without any problem." />
  
  <meta property="og:image" content="" />
  <meta property="og:url" content="/blog/2015/01/14/better-mvc/" >
  <meta property="og:type" content="blog" />
  <meta property="article:published_time" content="2015-01-14T21:25:14+01:00">

  <link rel="canonical" href="/blog/2015/01/14/better-mvc/"/>
  <link rel="shortcut icon" href="/assets/images/favicon.png" type="image/png"/>
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>
  <link href='/stylesheets/all-456658fd402f091f6213dc405e964de6.css' media='all' rel='stylesheet' type='text/css'>
  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->


<!-- header end -->
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Better MVC</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/assets/images/jg.jpg)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"></h4>
              on
              <time datetime="2015-01-14T21:25:14+01:00">14 Jan 2015</time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>I had been meaning to write this for a while now. And even if the examples are all in Swift (because shiny) the same can be applied to Objective-C code as well without any problem.</p>

<p>Slimming down your iOS view controllers is a big topic around the office and there was even an entire issue of <a href="http://www.objc.io/issue-1/">objc.io</a> centered around the topic (as well as another one on <a href="http://www.objc.io/issue-13/">architecture</a>).</p>

<p>We had also tried some <a href="http://www.objc.io/issue-13/mvvm.html">MVVM</a> as well as <a href="http://www.objc.io/issue-13/viper.html">Viper</a> (ok, being an avid Uncle Bob <a href="https://cleancoders.com">clean code</a> watcher and reader, I know this is about a lot more but imho doesn’t apply too well to iOS apps since there is only <em>one</em> presenter) but neither of those models really stuck. If you look at what Wikipedia has to say about <a href="http://en.wikipedia.org/wiki/Model–view–controller">MVC</a> you will notice that it mentions the model notifying its associated views and controllers. Aha! So why not try that:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">SimpleView</span><span class="p">:</span> <span class="kt">UIView</span> <span class="p">{</span>
  <span class="err">…</span>
  <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">nameTextField</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span>
  <span class="k">weak</span> <span class="k">var</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">SimpleModel</span><span class="o">!</span> <span class="p">{</span>
      <span class="k">didSet</span> <span class="p">{</span>
          <span class="n">model</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKeyPath</span><span class="p">:</span> <span class="s">"name"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="kt">New</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">context</span><span class="p">)</span>
      <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="err">…</span>
  
  <span class="k">override</span> <span class="kd">func</span> <span class="nf">observeValueForKeyPath</span><span class="p">(</span><span class="nv">keyPath</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">ofObject</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">,</span> <span class="nv">change</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSObject</span><span class="p">:</span><span class="kt">AnyObject</span><span class="p">],</span>
                                       <span class="nv">context</span><span class="p">:</span> <span class="kt">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="n">context</span> <span class="o">==</span> <span class="o">&amp;</span><span class="k">self</span><span class="o">.</span><span class="n">context</span> <span class="p">{</span>
          <span class="n">nameLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Hi there, </span><span class="se">\(</span><span class="n">change</span><span class="p">[</span><span class="kt">NSKeyValueChangeNewKey</span><span class="p">]</span><span class="o">!</span><span class="se">)</span><span class="s">"</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">super</span><span class="o">.</span><span class="nf">observeValueForKeyPath</span><span class="p">(</span><span class="n">keyPath</span><span class="p">,</span> <span class="nv">ofObject</span><span class="p">:</span> <span class="n">object</span><span class="p">,</span> <span class="nv">change</span><span class="p">:</span> <span class="n">change</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
      <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">didSubmit</span><span class="p">(</span><span class="nv">sender</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">controller</span><span class="o">.</span><span class="nf">didSubmitName</span><span class="p">(</span><span class="n">nameTextField</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The view takes care of all it’s own presentation and not the controller (as you’ll see in code most of the time). Now of course KVO can get pretty cumbersome when there are a lot of properties involved but you get the point. The controller has nothing to do with the presentation of the model and just received requests from the view to update the model. What does the controller look like?</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">SimpleController</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">didSubmitName</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>

<span class="p">}</span>

<span class="kd">class</span> <span class="kt">SimpleViewController</span><span class="p">:</span> <span class="kt">UIViewController</span><span class="p">,</span> <span class="kt">SimpleController</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">model</span> <span class="o">=</span> <span class="kt">SimpleModel</span><span class="p">()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">mainView</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">view</span> <span class="k">as</span> <span class="kt">SimpleView</span>
        <span class="n">mainView</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">mainView</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">didSubmitName</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Ok, very simple example indeed. What about something more involved:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">AdvancedView</span><span class="p">:</span> <span class="kt">UIView</span><span class="p">,</span> <span class="kt">UserModelObserver</span><span class="p">,</span> <span class="kt">RemoteModelObserver</span> <span class="p">{</span>
    <span class="err">…</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">userModel</span><span class="p">:</span> <span class="kt">UserModel</span><span class="o">!</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="n">userModel</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">remoteModel</span><span class="p">:</span> <span class="kt">RemoteModel</span><span class="o">!</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="n">remoteModel</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="err">…</span>  
<span class="p">}</span>
</code></pre></div></div>

<p>As you can see, the model implements two protocols this time and listens to two different models for changes. And again, the controller is very slim:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">AdvancedViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">userModel</span> <span class="o">=</span> <span class="kt">UserModel</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">remoteModel</span> <span class="o">=</span> <span class="kt">RemoteModel</span><span class="p">()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">advancedView</span> <span class="o">=</span> <span class="n">view</span> <span class="k">as</span> <span class="kt">AdvancedView</span>
        <span class="n">advancedView</span><span class="o">.</span><span class="n">controller</span> <span class="o">=</span> <span class="k">self</span>
        <span class="n">advancedView</span><span class="o">.</span><span class="n">userModel</span> <span class="o">=</span> <span class="n">userModel</span>
        <span class="n">advancedView</span><span class="o">.</span><span class="n">remoteModel</span> <span class="o">=</span> <span class="n">remoteModel</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">submit</span><span class="p">(</span><span class="nv">#firstName</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">userModel</span><span class="o">.</span><span class="n">firstName</span> <span class="o">=</span> <span class="n">firstName</span>
        <span class="n">userModel</span><span class="o">.</span><span class="n">lastName</span> <span class="o">=</span> <span class="n">lastName</span>
        <span class="n">userModel</span><span class="o">.</span><span class="nf">validate</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">load</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">remoteModel</span><span class="o">.</span><span class="nf">load</span><span class="p">()</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Any validation logic is done inside the models (which makes it easily testable). Code for loading remote resources is also done in the model:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">load</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">URL</span> <span class="o">=</span> <span class="kt">NSURL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="kt">Constants</span><span class="o">.</span><span class="kt">URLString</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">NSURLSession</span><span class="o">.</span><span class="nf">sharedSession</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="nf">dataTaskWithURL</span><span class="p">(</span><span class="kt">URL</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"Epic Fail"</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">var</span> <span class="nv">jsonError</span><span class="p">:</span> <span class="kt">NSError</span><span class="p">?</span>
            <span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="kt">NSJSONSerialization</span><span class="o">.</span><span class="kt">JSONObjectWithData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="kt">NSJSONReadingOptions</span><span class="o">.</span><span class="kt">AllowFragments</span><span class="p">,</span>
                    <span class="nv">error</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">jsonError</span><span class="p">)</span> <span class="k">as</span> <span class="kt">NSArray</span>
            <span class="k">self</span><span class="o">.</span><span class="n">comments</span> <span class="o">=</span> <span class="n">json</span>
            <span class="nf">dispatch_async</span><span class="p">(</span><span class="nf">dispatch_get_main_queue</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="nf">notifyObservers</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>I’ve uploaded a sample project over on <a href="https://github.com/JanGorman/BetterMVC">github</a> including a third example of a <code class="highlighter-rouge">UITableViewController</code> and some test code.</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=Better+MVC&amp;url=/blog/2015/01/14/better-mvc"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/assets/images/jg.jpg)">Blog Logo</div>
              <h4>Jan Gorman</h4>
              <p class="bio"></p>
              <hr>
              <p class="published">Published <time datetime="2015-01-14 21:25">14 Jan 2015</time></p>
            </section>
          </div>
          
          <div class="isRight">
            <h5 class="index-headline featured"><span>Supported by</span></h5>
            <footer class="site-footer">
              <section class="poweredby">Proudly published with <a href="http://jekyllrb.com"> Jekyll</a></section>
              <a class="subscribe" href="/feed.xml"> <span class="tooltip"> <i class="fa fa-rss"></i> You should subscribe to my feed.</span></a>
              <div class="inner">
                <section class="copyright">All content copyright <a href="/">Jan Gorman</a> &copy; 2017<br>All rights reserved.</section>
              </div>
            </footer>
          </div>
        </div>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/images/background-image.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">Jan Gorman</h1>
        <h2 class="blog-description">Compiling Swift Source Files</h2>
        <a href=/ class="btn">Back to Overview</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>
  </body>
</html>
